#!/bin/bash

# Pre-push hook to prevent accidental pushes to main branch
# and warn about production deployments

protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

# Colors
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Check if pushing to main
if [ "$current_branch" = "$protected_branch" ]; then
    echo -e "${RED}⚠️  WARNING: You're about to push to the MAIN branch!${NC}"
    echo -e "${YELLOW}This branch is typically used for production deployments.${NC}"
    echo ""
    read -p "Are you sure you want to push to main? (y/n): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "Push cancelled."
        exit 1
    fi
fi

# Check for firebase deploy commands in recent commits
if git log origin/main..HEAD --grep="firebase deploy" --oneline | grep -q .; then
    echo -e "${YELLOW}⚠️  Found 'firebase deploy' in recent commits.${NC}"
    echo "Remember to use targeted deployments:"
    echo "  - staging: firebase deploy --only hosting:staging"
    echo "  - production: firebase deploy --only hosting:live"
fi

exit 0