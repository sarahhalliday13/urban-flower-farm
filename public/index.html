<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#2c5530" />
    <meta
      name="description"
      content="Buttons Urban Flower Farm - Your local source for beautiful native and drought-tolerant plants in the Vancouver area."
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="%PUBLIC_URL%/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="%PUBLIC_URL%/favicon-16x16.png" />
    <!-- CORS policy meta tags - use more permissive policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob: filesystem: about: ws: wss:; connect-src * 'self' wss://*.firebaseio.com https://*.firebaseio.com https://*.googleapis.com https://*.firebase.io https://firebasestorage.googleapis.com data:; script-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline';" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Buttons Flower Farm</title>
    
    <!-- Script to handle chunk loading errors -->
    <script type="text/javascript">
      // Store which chunks failed to load
      window.chunkLoadErrors = [];
      
      // Function to handle chunk load errors
      window.handleChunkError = function(error) {
        console.error('Chunk loading failed:', error);
        
        // Store the failed chunk URL
        if (error.target && error.target.src) {
          window.chunkLoadErrors.push(error.target.src);
        }
        
        // Add this error to session storage to track across page refreshes
        try {
          var storedErrors = JSON.parse(sessionStorage.getItem('chunkErrors') || '[]');
          if (error.target && error.target.src) {
            storedErrors.push({
              src: error.target.src,
              time: new Date().toISOString()
            });
            sessionStorage.setItem('chunkErrors', JSON.stringify(storedErrors));
          }
        } catch (e) {
          console.error('Error storing chunk error in sessionStorage:', e);
        }
        
        // Prevent the error from bubbling up
        error.preventDefault();
        
        // If we've tried to reload already, don't infinite loop
        var reloadAttempts = parseInt(sessionStorage.getItem('reloadAttempts') || '0');
        
        // Cap the reload attempts to 2 to prevent reload loops
        if (reloadAttempts < 2) {
          console.log('Attempting to reload due to chunk error. Attempt #' + (reloadAttempts + 1));
          sessionStorage.setItem('reloadAttempts', (reloadAttempts + 1).toString());
          
          // Add cache busting parameter to force a fresh load
          window.location.href = window.location.href + 
            (window.location.search ? '&' : '?') + 
            'reload=' + new Date().getTime();
        } else {
          console.log('Max reload attempts reached. Not reloading automatically.');
          
          // Show a user-friendly error message if possible
          var rootElement = document.getElementById('root');
          if (rootElement) {
            rootElement.innerHTML = '<div style="text-align: center; padding: 20px; font-family: Arial, sans-serif;">' +
              '<h2 style="color: #d32f2f;">Error Loading Content</h2>' +
              '<p>We\'re having trouble loading some resources. Please try refreshing the page.</p>' +
              '<button onclick="window.location.reload()" style="background-color: #2c5530; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-top: 15px;">Refresh Page</button>' +
              '</div>';
          }
        }
      };
      
      // Listen for all script errors
      window.addEventListener('error', function(event) {
        if (event.target && event.target.tagName === 'SCRIPT') {
          window.handleChunkError(event);
        }
      }, true);
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
